import{c as q,o as J,r as l,j as e,m as _,i as K,X as k}from"./index-BMjTxWI5.js";import{a as P}from"./adminStore-69BTUR3l.js";import{B as Q}from"./Button-D0cEhXue.js";import{M as W}from"./Modal-DaGtJTxd.js";import{T as Y}from"./TransactionModal-CIAkmZng.js";import{f as N}from"./formatters-DNE1yS1Z.js";import{f as T}from"./dateUtils-S97u1aLj.js";import{E as R}from"./eye-Bw0ziA_o.js";import{C as $}from"./check-DLZoD-Wd.js";import"./AccountService-vNVs7x2E.js";/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],ee=q("download",Z),se="_transactionManagement_1vivw_1",te="_header_1vivw_11",ae="_title_1vivw_27",ne="_subtitle_1vivw_43",ie="_stats_1vivw_57",oe="_statCard_1vivw_71",le="_statValue_1vivw_99",ce="_statLabel_1vivw_115",re="_controls_1vivw_129",de="_search_1vivw_145",me="_searchIcon_1vivw_159",ve="_searchInput_1vivw_177",he="_filters_1vivw_225",_e="_filterGroup_1vivw_239",pe="_filterSelect_1vivw_251",ue="_tableContainer_1vivw_319",be="_table_1vivw_319",je="_tableRow_1vivw_385",xe="_transactionId_1vivw_403",we="_userInfo_1vivw_415",fe="_avatar_1vivw_427",ye="_userEmail_1vivw_455",Ne="_type_1vivw_471",Te="_status_1vivw_471",ge="_warning_1vivw_497",Ie="_success_1vivw_509",Ce="_error_1vivw_521",Se="_amount_1vivw_533",Le="_method_1vivw_545",ke="_date_1vivw_557",Re="_actions_1vivw_569",$e="_actionBtn_1vivw_579",Ue="_reject_1vivw_621",Ae="_loading_1vivw_631",Ve="_loadingSpinner_1vivw_653",Ee="_spin_1vivw_1",Me="_emptyState_1vivw_683",Be="_emptyContent_1vivw_699",ze="_emptyTitle_1vivw_707",De="_emptyText_1vivw_723",Fe="_mobileTransactions_1vivw_743",Oe="_mobileTransactionCard_1vivw_755",Ge="_mobileTransactionHeader_1vivw_775",He="_mobileTransactionId_1vivw_789",Xe="_mobileUserInfo_1vivw_803",qe="_mobileAvatar_1vivw_817",Je="_mobileUserEmail_1vivw_845",Ke="_mobileTransactionInfo_1vivw_857",Pe="_mobileInfoRow_1vivw_869",Qe="_mobileInfoLabel_1vivw_893",We="_mobileInfoValue_1vivw_905",Ye="_mobileType_1vivw_919",Ze="_mobileAmount_1vivw_937",es="_mobileStatus_1vivw_947",ss="_mobileActions_1vivw_967",s={transactionManagement:se,header:te,title:ae,subtitle:ne,stats:ie,statCard:oe,statValue:le,statLabel:ce,controls:re,search:de,searchIcon:me,searchInput:ve,filters:he,filterGroup:_e,filterSelect:pe,tableContainer:ue,table:be,tableRow:je,transactionId:xe,userInfo:we,avatar:fe,userEmail:ye,type:Ne,status:Te,warning:ge,success:Ie,error:Ce,amount:Se,method:Le,date:ke,actions:Re,actionBtn:$e,reject:Ue,loading:Ae,loadingSpinner:Ve,spin:Ee,emptyState:Me,emptyContent:Be,emptyTitle:ze,emptyText:De,mobileTransactions:Fe,mobileTransactionCard:Oe,mobileTransactionHeader:Ge,mobileTransactionId:He,mobileUserInfo:Xe,mobileAvatar:qe,mobileUserEmail:Je,mobileTransactionInfo:Ke,mobileInfoRow:Pe,mobileInfoLabel:Qe,mobileInfoValue:We,mobileType:Ye,mobileAmount:Ze,mobileStatus:es,mobileActions:ss},vs=J(()=>{const{transactions:U,loading:g,fetchTransactions:d,approveTransaction:A,rejectTransaction:V}=P,[p,E]=l.useState("deposit"),[u,M]=l.useState("pending"),[b,B]=l.useState(""),[I,z]=l.useState(null),[D,m]=l.useState(!1),[F,v]=l.useState(!1);l.useEffect(()=>{d()},[d]);const n=U.filter(t=>{const a=t.id?.toString().includes(b)||t.user?.email?.toLowerCase().includes(b.toLowerCase()),c=p==="all"||t.type===p,r=u==="all"||t.status===u;return c&&r&&a}),C=t=>({pending:"warning",completed:"success",cancelled:"error",rejected:"error"})[t]||"secondary",j=t=>({pending:"Ожидание",completed:"Завершено",cancelled:"Отменено",rejected:"Отклонено"})[t]||t,x=t=>t==="deposit"?"Пополнение баланса":"Оплата аренды",S=t=>({balance:"Баланс",bank_transfer:"Банковский перевод",crypto:"Криптовалюта"})[t]||t,w=async t=>{v(!0);try{await A(t),m(!1),await d()}catch{alert("Ошибка при подтверждении транзакции")}finally{v(!1)}},f=async t=>{const a=prompt("Причина отклонения:");if(a){v(!0);try{await V(t,a),m(!1),await d()}catch{alert("Ошибка при отклонении транзакции")}finally{v(!1)}}},L=t=>{z(t),m(!0)},O=async t=>{try{const a=await fetch(`/api/admin/checks/${t}`,{method:"GET",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(a.ok){const c=await a.blob(),r=window.URL.createObjectURL(c),o=document.createElement("a");o.href=r,o.download=t,document.body.appendChild(o),o.click(),window.URL.revokeObjectURL(r),document.body.removeChild(o)}else alert("Ошибка при скачивании чека")}catch(a){console.error("Error downloading check:",a),alert("Ошибка при скачивании чека")}},G=t=>{const a=`/api/admin/checks/${t}`;window.open(a,"_blank")},H=()=>{const t=["ID","Пользователь","Тип","Сумма","Статус","Метод","Дата"],a=n.map(i=>[i.id,i.User?.email,x(i.type),i.amount,j(i.status),S(i.method),T(i.createdAt)]),c=[t,...a].map(i=>i.map(X=>`"${X}"`).join(",")).join(`
`),r=new Blob([c],{type:"text/csv"}),o=URL.createObjectURL(r),y=document.createElement("a");y.href=o,y.download=`transactions_${new Date().toISOString().split("T")[0]}.csv`,y.click(),URL.revokeObjectURL(o)},h={totalVolume:n.reduce((t,a)=>t+(a.type==="deposit"?a.amount:0),0),totalTransactions:n.length,pendingCount:n.filter(t=>t.status==="pending").length,successRate:n.length>0?(n.filter(t=>t.status==="completed").length/n.length*100).toFixed(1):0};return e.jsxs(_.div,{initial:{opacity:0},animate:{opacity:1},className:s.transactionManagement,children:[e.jsxs("div",{className:s.header,children:[e.jsxs("div",{children:[e.jsx("h1",{className:s.title,children:"Управление балансом пользователей"}),e.jsx("p",{className:s.subtitle,children:"Просмотр и управление финансовыми операциями"})]}),e.jsxs(Q,{variant:"primary",onClick:H,children:[e.jsx(ee,{size:16}),"Экспорт"]})]}),e.jsxs("div",{className:s.stats,children:[e.jsxs("div",{className:s.statCard,children:[e.jsx("div",{className:s.statValue,children:N(h.totalVolume)}),e.jsx("div",{className:s.statLabel,children:"Общий объем"})]}),e.jsxs("div",{className:s.statCard,children:[e.jsx("div",{className:s.statValue,children:h.totalTransactions}),e.jsx("div",{className:s.statLabel,children:"Всего транзакций"})]}),e.jsxs("div",{className:s.statCard,children:[e.jsx("div",{className:s.statValue,children:h.pendingCount}),e.jsx("div",{className:s.statLabel,children:"Ожидают проверки"})]}),e.jsxs("div",{className:s.statCard,children:[e.jsxs("div",{className:s.statValue,children:[h.successRate,"%"]}),e.jsx("div",{className:s.statLabel,children:"Успешных операций"})]})]}),e.jsxs("div",{className:s.controls,children:[e.jsxs("div",{className:s.search,children:[e.jsx(K,{size:20,className:s.searchIcon}),e.jsx("input",{type:"text",placeholder:"Поиск транзакций...",className:s.searchInput,value:b,onChange:t=>B(t.target.value)})]}),e.jsx("div",{className:s.filters,children:e.jsxs("div",{className:s.filterGroup,children:[e.jsxs("select",{className:s.filterSelect,value:p,onChange:t=>E(t.target.value),children:[e.jsx("option",{value:"all",children:"Все типы транзакций"}),e.jsx("option",{value:"deposit",children:"Пополнение баланса"}),e.jsx("option",{value:"payment",children:"Оплата аренды"})]}),e.jsxs("select",{className:s.filterSelect,value:u,onChange:t=>M(t.target.value),children:[e.jsx("option",{value:"all",children:"Все статусы"}),e.jsx("option",{value:"pending",children:"Ожидание"}),e.jsx("option",{value:"completed",children:"Завершен"}),e.jsx("option",{value:"cancelled",children:"Отменен"})]})]})})]}),e.jsx("div",{className:s.tableContainer,children:g?e.jsx("div",{className:s.loading,children:"Загрузка транзакций..."}):e.jsxs("table",{className:s.table,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID транзакции"}),e.jsx("th",{children:"Пользователь"}),e.jsx("th",{children:"Тип"}),e.jsx("th",{children:"Сумма"}),e.jsx("th",{children:"Статус"}),e.jsx("th",{children:"Дата создания"}),e.jsx("th",{children:"Действия"})]})}),e.jsx("tbody",{children:n.map((t,a)=>e.jsxs(_.tr,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:a*.1},className:s.tableRow,children:[e.jsxs("td",{className:s.transactionId,children:["#",t.id]}),e.jsx("td",{children:e.jsxs("div",{className:s.userInfo,children:[e.jsx("div",{className:s.avatar,children:t.user?.email?.charAt(0).toUpperCase()||"U"}),e.jsx("span",{children:t.user?.email||"Пользователь удален"})]})}),e.jsx("td",{children:e.jsx("span",{className:`${s.type} ${s.primary}`,children:x(t.type)})}),e.jsxs("td",{className:`${s.amount} ${s.primary}`,children:[t.type==="deposit"?"+":"-",N(t.amount)]}),e.jsx("td",{children:e.jsx("span",{className:`${s.status} ${s[C(t.status)]}`,children:j(t.status)})}),e.jsx("td",{className:s.date,children:T(t.createdAt)}),e.jsx("td",{children:e.jsxs("div",{className:s.actions,children:[e.jsx("button",{onClick:()=>L(t),className:s.actionBtn,title:"Просмотр",children:e.jsx(R,{size:16})}),t.status==="pending"&&t.type==="deposit"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>w(t.id),className:s.actionBtn,title:"Подтвердить",children:e.jsx($,{size:16})}),e.jsx("button",{onClick:()=>f(t.id),className:`${s.actionBtn} ${s.reject}`,title:"Отклонить",children:e.jsx(k,{size:16})})]})]})})]},t.id))})]})}),e.jsx("div",{className:s.mobileTransactions,children:n.map((t,a)=>e.jsxs(_.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:a*.1},className:s.mobileTransactionCard,children:[e.jsxs("div",{className:s.mobileTransactionHeader,children:[e.jsxs("div",{className:s.mobileTransactionId,children:["#",t.id]}),e.jsx("span",{className:`${s.mobileStatus} ${s[C(t.status)]}`,children:j(t.status)})]}),e.jsxs("div",{className:s.mobileUserInfo,children:[e.jsx("div",{className:s.mobileAvatar,children:t.user?.email?.charAt(0).toUpperCase()||"U"}),e.jsx("span",{className:s.mobileUserEmail,children:t.user?.email||"Пользователь удален"})]}),e.jsxs("div",{className:s.mobileTransactionInfo,children:[e.jsxs("div",{className:s.mobileInfoRow,children:[e.jsx("span",{className:s.mobileInfoLabel,children:"Тип:"}),e.jsx("span",{className:`${s.mobileType} ${s.primary}`,children:x(t.type)})]}),e.jsxs("div",{className:s.mobileInfoRow,children:[e.jsx("span",{className:s.mobileInfoLabel,children:"Сумма:"}),e.jsxs("span",{className:`${s.mobileAmount} ${s.primary}`,children:[t.type==="deposit"?"+":"-",N(t.amount)]})]}),e.jsxs("div",{className:s.mobileInfoRow,children:[e.jsx("span",{className:s.mobileInfoLabel,children:"Дата:"}),e.jsx("span",{className:s.mobileInfoValue,children:T(t.createdAt)})]}),e.jsxs("div",{className:s.mobileInfoRow,children:[e.jsx("span",{className:s.mobileInfoLabel,children:"Метод:"}),e.jsx("span",{className:s.mobileInfoValue,children:S(t.method)})]})]}),e.jsxs("div",{className:s.mobileActions,children:[e.jsxs("button",{onClick:()=>L(t),className:s.actionBtn,title:"Просмотр",children:[e.jsx(R,{size:16}),"Детали"]}),t.status==="pending"&&t.type==="deposit"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>w(t.id),className:s.actionBtn,title:"Подтвердить",children:[e.jsx($,{size:16}),"Подтвердить"]}),e.jsxs("button",{onClick:()=>f(t.id),className:`${s.actionBtn} ${s.reject}`,title:"Отклонить",children:[e.jsx(k,{size:16}),"Отклонить"]})]})]})]},t.id))}),e.jsx(W,{isOpen:D,onClose:()=>m(!1),title:`Транзакция #${I?.id}`,size:"large",children:e.jsx(Y,{transaction:I,onApprove:w,onReject:f,onDownloadCheck:O,onViewCheck:G,loading:F})}),n.length===0&&!g&&e.jsx(_.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:s.emptyState,children:e.jsxs("div",{className:s.emptyContent,children:[e.jsx("h3",{className:s.emptyTitle,children:"Транзакции не найдены"}),e.jsx("p",{className:s.emptyText,children:"Попробуйте изменить параметры фильтрации"})]})})]})});export{vs as default};
