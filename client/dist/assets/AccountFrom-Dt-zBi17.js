import{c as _,o as A,e as $,u as H,r as d,j as e,m as D,R as G}from"./index-C-KVzDfL.js";import{a as R}from"./adminStore-CQx7drL5.js";import{a as J}from"./accountStore-UEATRuqG.js";import{B as W}from"./Button-DNnCRmfV.js";import{T as x}from"./trash-2-Bup_68xb.js";import"./AccountService-BxV9YHVG.js";/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],Q=_("arrow-left",q);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],Y=_("image",X);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],K=_("save",Z);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]],se=_("video",ee),te="_accountForm_kw6jv_1",ae="_header_kw6jv_11",ie="_headerContent_kw6jv_27",ce="_backButton_kw6jv_35",ne="_title_kw6jv_71",re="_subtitle_kw6jv_87",le="_saveButton_kw6jv_101",oe="_form_kw6jv_109",de="_formGrid_kw6jv_123",ue="_column_kw6jv_135",me="_section_kw6jv_147",pe="_sectionHeader_kw6jv_159",he="_sectionTitle_kw6jv_173",ve="_formGroup_kw6jv_187",je="_label_kw6jv_199",xe="_input_kw6jv_211",_e="_select_kw6jv_211",fe="_textarea_kw6jv_211",Ne="_featuresSection_kw6jv_407",ge="_selectedFeatures_kw6jv_419",be="_featureChip_kw6jv_435",ke="_featureLabel_kw6jv_461",we="_removeFeature_kw6jv_469",ye="_noFeatures_kw6jv_505",Fe="_mediaPreview_kw6jv_609",Me="_previewMedia_kw6jv_623",Se="_fileUploadSection_kw6jv_651",Ce="_hiddenInput_kw6jv_679",Be="_uploadButton_kw6jv_687",Ie="_removeMedia_kw6jv_757",s={accountForm:te,header:ae,headerContent:ie,backButton:ce,title:ne,subtitle:re,saveButton:le,form:oe,formGrid:de,column:ue,section:me,sectionHeader:pe,sectionTitle:he,formGroup:ve,label:je,input:xe,select:_e,textarea:fe,featuresSection:Ne,selectedFeatures:ge,featureChip:be,featureLabel:ke,removeFeature:we,noFeatures:ye,mediaPreview:Fe,previewMedia:Me,fileUploadSection:Se,hiddenInput:Ce,uploadButton:Be,removeMedia:Ie},Ue=A(()=>{const{id:v}=$(),b=H(),r=!!v,{loading:k,createAccount:V,updateAccount:P}=R,{account:i,fetchAccount:w}=J,[c,f]=d.useState({title:"",account_number:"",price:"",characters:{},status:"free",description:""}),y=[{key:"bape",label:"Bape"},{key:"crewUniform",label:"Crew Uniform"},{key:"more300mif",label:"More 300 MIF"}],[u,F]=d.useState([]),[l,M]=d.useState(null),[o,S]=d.useState(null),[p,N]=d.useState(""),[h,g]=d.useState("");d.useEffect(()=>{r&&v&&w(v)},[r,v,w]),d.useEffect(()=>{if(r&&i){let t={};if(i.characters)if(typeof i.characters=="string")try{t=JSON.parse(i.characters)}catch(a){console.error("Error parsing characters:",a),t={}}else t=i.characters;if(f({title:i.title||"",account_number:i.account_number||"",price:i.price||"",characters:t,status:i.status||"free",description:i.description||""}),i.img&&N(i.img),i.video&&g(i.video),i.characters){const a=typeof i.characters=="string"?JSON.parse(i.characters):i.characters,n=Object.keys(a).filter(m=>a[m]===!0);F(n)}}},[i,r]);const T=t=>{const n=["image/jpeg","image/jpg","image/png","image/webp"];return t.size>10485760?(alert(`Размер изображения не должен превышать 10MB. Ваш файл: ${(t.size/(1024*1024)).toFixed(1)}MB`),!1):n.includes(t.type)?!0:(alert("Разрешены только изображения: JPG, PNG, WEBP"),!1)},E=t=>{const n=["video/mp4","video/avi","video/mov","video/wmv","video/webm","video/quicktime"];return t.size>209715200?(alert(`Размер видео не должен превышать 200MB. Ваш файл: ${(t.size/(1024*1024)).toFixed(1)}MB`),!1):n.includes(t.type)?!0:(alert("Разрешены только видео файлы: MP4, AVI, MOV, WMV, WEBM"),!1)},U=t=>{const a=t.target.files[0];if(a){if(!T(a)){t.target.value="";return}M(a),N("")}},O=t=>{const a=t.target.files[0];if(a){if(!E(a)){t.target.value="";return}S(a),g("")}},C=()=>{M(null),N("")},B=()=>{S(null),g("")},j=(t,a)=>{f(n=>({...n,[t]:a}))},I=t=>{const a=u.includes(t)?u.filter(m=>m!==t):[...u,t];F(a);const n={};a.forEach(m=>{n[m]=!0}),f(m=>({...m,characters:n}))},L=t=>{const a=t.target.value;a&&!u.includes(a)&&I(a),t.target.value=""},z=async t=>{if(t.preventDefault(),!c.title.trim()){alert("Введите название аккаунта");return}if(!c.account_number){alert("Введите номер аккаунта");return}if(c.price<=0){alert("Введите корректную цену");return}try{const a=new FormData;a.append("title",c.title),a.append("account_number",c.account_number),a.append("description",c.description||""),a.append("characters",JSON.stringify(c.characters)),a.append("price",c.price),a.append("status",c.status),r?(l?a.append("img",l):!p&&!l?a.append("removeImg","true"):p&&!l&&a.append("existingImg",p),o?a.append("video",o):!h&&!o?a.append("removeVideo","true"):h&&!o&&a.append("existingVideo",h)):(l&&(console.log("img"),a.append("img",l)),o&&(console.log("video"),a.append("video",o))),r?await P(v,a):(console.log(a),await V(a)),b(G.ADMIN_ACCOUNTS)}catch(a){alert(`Ошибка при ${r?"обновлении":"создании"} аккаунта`),console.error("Error:",a)}};return e.jsxs(D.div,{initial:{opacity:0},animate:{opacity:1},className:s.accountForm,children:[e.jsxs("div",{className:s.header,children:[e.jsxs("div",{className:s.headerContent,children:[e.jsxs("button",{className:s.backButton,onClick:()=>b(G.ADMIN_ACCOUNTS),children:[e.jsx(Q,{size:20}),"Назад к списку"]}),e.jsx("h1",{className:s.title,children:r?"Редактирование аккаунта":"Добавление аккаунта"}),e.jsx("p",{className:s.subtitle,children:r?"Внесите изменения в данные аккаунта":"Заполните информацию о новом аккаунте"})]}),e.jsxs(W,{variant:"primary",onClick:z,disabled:k,className:s.saveButton,children:[e.jsx(K,{size:16}),k?"Сохранение...":r?"Обновить":"Создать"]})]}),e.jsx("form",{onSubmit:z,className:s.form,children:e.jsxs("div",{className:s.formGrid,children:[e.jsxs("div",{className:s.column,children:[e.jsxs("div",{className:s.section,children:[e.jsx("h3",{className:s.sectionTitle,children:"Основная информация"}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.label,children:"Название аккаунта *"}),e.jsx("input",{type:"text",className:s.input,value:c.title,onChange:t=>j("title",t.target.value),placeholder:"Краткое описание аккаунта...",required:!0})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.label,children:"Номер аккаунта *"}),e.jsx("input",{type:"text",className:s.input,value:c.account_number,onChange:t=>j("account_number",t.target.value),placeholder:"Номер, который будут видеть пользователи...",required:!0})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.label,children:"Цена за час (руб) *"}),e.jsx("input",{type:"number",className:s.input,value:c.price,onChange:t=>j("price",t.target.value),placeholder:"0",min:"0",step:"1",required:!0})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.label,children:"Статус"}),e.jsxs("select",{className:s.select,value:c.status,onChange:t=>j("status",t.target.value),children:[e.jsx("option",{value:"free",children:"Свободен"}),e.jsx("option",{value:"rented",children:"Арендован"}),e.jsx("option",{value:"unavailable",children:"Недоступен"})]})]})]}),e.jsxs("div",{className:s.section,children:[e.jsx("h3",{className:s.sectionTitle,children:"Описание"}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.label,children:"Описание аккаунта"}),e.jsx("textarea",{className:s.textarea,value:c.description,onChange:t=>j("description",t.target.value),placeholder:"Подробное описание аккаунта, его особенности и преимущества...",rows:"4"})]})]})]}),e.jsxs("div",{className:s.column,children:[e.jsxs("div",{className:s.section,children:[e.jsx("h3",{className:s.sectionTitle,children:"Медиафайлы"}),e.jsxs("div",{className:s.formGroup,children:[e.jsxs("label",{className:s.label,children:["Изображение аккаунта",e.jsx("span",{className:s.fileHint,children:" (макс. 10MB, JPG, PNG, WEBP)"})]}),e.jsxs("div",{className:s.fileUploadSection,children:[e.jsx("input",{type:"file",accept:"image/*",onChange:U,className:s.hiddenInput,id:"image-upload"}),p||l?e.jsx("div",{className:s.mediaPreview,children:l?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:URL.createObjectURL(l),alt:"Preview",className:s.previewMedia}),e.jsx("button",{type:"button",onClick:C,className:s.removeMedia,children:e.jsx(x,{size:16})})]}):p?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:`/api/img/${p}`,alt:"Current",className:s.previewMedia}),e.jsx("button",{type:"button",onClick:C,className:s.removeMedia,children:e.jsx(x,{size:16})})]}):null}):e.jsxs("label",{htmlFor:"image-upload",className:s.uploadButton,children:[e.jsx(Y,{size:20}),e.jsx("span",{children:"Загрузить изображение"})]})]})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsxs("label",{className:s.label,children:["Видео обзор",e.jsx("span",{className:s.fileHint,children:" (макс. 200MB, MP4, AVI, MOV, WMV)"})]}),e.jsxs("div",{className:s.fileUploadSection,children:[e.jsx("input",{type:"file",accept:"video/*",onChange:O,className:s.hiddenInput,id:"video-upload"}),h||o?e.jsx("div",{className:s.mediaPreview,children:o?e.jsxs(e.Fragment,{children:[e.jsx("video",{controls:!0,className:s.previewMedia,children:e.jsx("source",{src:URL.createObjectURL(o),type:"video/mp4"})}),e.jsx("button",{type:"button",onClick:B,className:s.removeMedia,children:e.jsx(x,{size:16})})]}):h?e.jsxs(e.Fragment,{children:[e.jsx("video",{controls:!0,className:s.previewMedia,children:e.jsx("source",{src:`/api/video/${h}`,type:"video/mp4"})}),e.jsx("button",{type:"button",onClick:B,className:s.removeMedia,children:e.jsx(x,{size:16})})]}):null}):e.jsxs("label",{htmlFor:"video-upload",className:s.uploadButton,children:[e.jsx(se,{size:20}),e.jsx("span",{children:"Загрузить видео"})]})]})]})]}),e.jsxs("div",{className:s.section,children:[e.jsx("div",{className:s.sectionHeader,children:e.jsx("h3",{className:s.sectionTitle,children:"Характеристики"})}),e.jsxs("div",{className:s.featuresSection,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.label,children:"Добавить характеристику"}),e.jsxs("select",{className:s.select,onChange:L,value:"",children:[e.jsx("option",{value:"",children:"Выберите характеристику..."}),y.map(t=>e.jsx("option",{value:t.key,disabled:u.includes(t.key),children:t.label},t.key))]})]}),e.jsxs("div",{className:s.selectedFeatures,children:[u.map(t=>{const a=y.find(n=>n.key===t);return e.jsxs("div",{className:s.featureChip,children:[e.jsx("span",{className:s.featureLabel,children:a?.label}),e.jsx("button",{type:"button",className:s.removeFeature,onClick:()=>I(t),children:e.jsx(x,{size:14})})]},t)}),u.length===0&&e.jsx("div",{className:s.noFeatures,children:"Характеристики не выбраны"})]})]})]})]})]})})]})});export{Ue as default};
