import{c as _,o as V,e as A,u as $,r as d,j as e,m as D,R as U}from"./index-BMjTxWI5.js";import{a as H}from"./adminStore-69BTUR3l.js";import{a as P}from"./accountStore-C6L7ROPf.js";import{B as R}from"./Button-D0cEhXue.js";import{T as x}from"./trash-2-DfGCYa6Z.js";import"./AccountService-vNVs7x2E.js";/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],J=_("arrow-left",q);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],W=_("image",Q);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],Y=_("save",X);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]],K=_("video",Z),ee="_accountForm_kw6jv_1",se="_header_kw6jv_11",ae="_headerContent_kw6jv_27",te="_backButton_kw6jv_35",ce="_title_kw6jv_71",ie="_subtitle_kw6jv_87",ne="_saveButton_kw6jv_101",re="_form_kw6jv_109",le="_formGrid_kw6jv_123",oe="_column_kw6jv_135",de="_section_kw6jv_147",ue="_sectionHeader_kw6jv_159",me="_sectionTitle_kw6jv_173",pe="_formGroup_kw6jv_187",he="_label_kw6jv_199",ve="_input_kw6jv_211",je="_select_kw6jv_211",xe="_textarea_kw6jv_211",_e="_featuresSection_kw6jv_407",fe="_selectedFeatures_kw6jv_419",Ne="_featureChip_kw6jv_435",be="_featureLabel_kw6jv_461",ge="_removeFeature_kw6jv_469",ke="_noFeatures_kw6jv_505",we="_mediaPreview_kw6jv_609",ye="_previewMedia_kw6jv_623",Fe="_fileUploadSection_kw6jv_651",Ce="_hiddenInput_kw6jv_679",Se="_uploadButton_kw6jv_687",Me="_removeMedia_kw6jv_757",s={accountForm:ee,header:se,headerContent:ae,backButton:te,title:ce,subtitle:ie,saveButton:ne,form:re,formGrid:le,column:oe,section:de,sectionHeader:ue,sectionTitle:me,formGroup:pe,label:he,input:ve,select:je,textarea:xe,featuresSection:_e,selectedFeatures:fe,featureChip:Ne,featureLabel:be,removeFeature:ge,noFeatures:ke,mediaPreview:we,previewMedia:ye,fileUploadSection:Fe,hiddenInput:Ce,uploadButton:Se,removeMedia:Me},ze=V(()=>{const{id:v}=A(),g=$(),n=!!v,{loading:k,createAccount:T,updateAccount:L}=H,{account:c,fetchAccount:w}=P,[i,f]=d.useState({title:"",account_number:"",price:"",characters:{},status:"free",description:""}),y=[{key:"bape",label:"Bape"},{key:"crewUniform",label:"Crew Uniform"},{key:"more300mif",label:"More 300 MIF"}],[u,F]=d.useState([]),[r,C]=d.useState(null),[l,S]=d.useState(null),[p,N]=d.useState(""),[h,b]=d.useState("");d.useEffect(()=>{n&&v&&w(v)},[n,v,w]),d.useEffect(()=>{if(n&&c){let t={};if(c.characters)if(typeof c.characters=="string")try{t=JSON.parse(c.characters)}catch(a){console.error("Error parsing characters:",a),t={}}else t=c.characters;if(f({title:c.title||"",account_number:c.account_number||"",price:c.price||"",characters:t,status:c.status||"free",description:c.description||""}),c.img&&N(c.img),c.video&&b(c.video),c.characters){const a=typeof c.characters=="string"?JSON.parse(c.characters):c.characters,o=Object.keys(a).filter(m=>a[m]===!0);F(o)}}},[c,n]);const z=t=>{const a=t.target.files[0];a&&(C(a),N(""))},E=t=>{const a=t.target.files[0];a&&(S(a),b(""))},M=()=>{C(null),N("")},I=()=>{S(null),b("")},j=(t,a)=>{f(o=>({...o,[t]:a}))},B=t=>{const a=u.includes(t)?u.filter(m=>m!==t):[...u,t];F(a);const o={};a.forEach(m=>{o[m]=!0}),f(m=>({...m,characters:o}))},O=t=>{const a=t.target.value;a&&!u.includes(a)&&B(a),t.target.value=""},G=async t=>{if(t.preventDefault(),!i.title.trim()){alert("Введите название аккаунта");return}if(!i.account_number){alert("Введите номер аккаунта");return}if(i.price<=0){alert("Введите корректную цену");return}try{const a=new FormData;a.append("title",i.title),a.append("account_number",i.account_number),a.append("description",i.description||""),a.append("characters",JSON.stringify(i.characters)),a.append("price",i.price),a.append("status",i.status),n?(r?a.append("img",r):!p&&!r?a.append("removeImg","true"):p&&!r&&a.append("existingImg",p),l?a.append("video",l):!h&&!l?a.append("removeVideo","true"):h&&!l&&a.append("existingVideo",h)):(r&&a.append("img",r),l&&a.append("video",l)),n?await L(v,a):await T(a),g(U.ADMIN_ACCOUNTS)}catch(a){alert(`Ошибка при ${n?"обновлении":"создании"} аккаунта`),console.error("Error:",a)}};return e.jsxs(D.div,{initial:{opacity:0},animate:{opacity:1},className:s.accountForm,children:[e.jsxs("div",{className:s.header,children:[e.jsxs("div",{className:s.headerContent,children:[e.jsxs("button",{className:s.backButton,onClick:()=>g(U.ADMIN_ACCOUNTS),children:[e.jsx(J,{size:20}),"Назад к списку"]}),e.jsx("h1",{className:s.title,children:n?"Редактирование аккаунта":"Добавление аккаунта"}),e.jsx("p",{className:s.subtitle,children:n?"Внесите изменения в данные аккаунта":"Заполните информацию о новом аккаунте"})]}),e.jsxs(R,{variant:"primary",onClick:G,disabled:k,className:s.saveButton,children:[e.jsx(Y,{size:16}),k?"Сохранение...":n?"Обновить":"Создать"]})]}),e.jsx("form",{onSubmit:G,className:s.form,children:e.jsxs("div",{className:s.formGrid,children:[e.jsxs("div",{className:s.column,children:[e.jsxs("div",{className:s.section,children:[e.jsx("h3",{className:s.sectionTitle,children:"Основная информация"}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.label,children:"Название аккаунта *"}),e.jsx("input",{type:"text",className:s.input,value:i.title,onChange:t=>j("title",t.target.value),placeholder:"Краткое описание аккаунта...",required:!0})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.label,children:"Номер аккаунта *"}),e.jsx("input",{type:"text",className:s.input,value:i.account_number,onChange:t=>j("account_number",t.target.value),placeholder:"Номер, который будут видеть пользователи...",required:!0})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.label,children:"Цена за час (руб) *"}),e.jsx("input",{type:"number",className:s.input,value:i.price,onChange:t=>j("price",t.target.value),placeholder:"0",min:"0",step:"1",required:!0})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.label,children:"Статус"}),e.jsxs("select",{className:s.select,value:i.status,onChange:t=>j("status",t.target.value),children:[e.jsx("option",{value:"free",children:"Свободен"}),e.jsx("option",{value:"rented",children:"Арендован"}),e.jsx("option",{value:"unavailable",children:"Недоступен"})]})]})]}),e.jsxs("div",{className:s.section,children:[e.jsx("h3",{className:s.sectionTitle,children:"Описание"}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.label,children:"Описание аккаунта"}),e.jsx("textarea",{className:s.textarea,value:i.description,onChange:t=>j("description",t.target.value),placeholder:"Подробное описание аккаунта, его особенности и преимущества...",rows:"4"})]})]})]}),e.jsxs("div",{className:s.column,children:[e.jsxs("div",{className:s.section,children:[e.jsx("h3",{className:s.sectionTitle,children:"Медиафайлы"}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.label,children:"Изображение аккаунта"}),e.jsxs("div",{className:s.fileUploadSection,children:[e.jsx("input",{type:"file",accept:"image/*",onChange:z,className:s.hiddenInput,id:"image-upload"}),p||r?e.jsx("div",{className:s.mediaPreview,children:r?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:URL.createObjectURL(r),alt:"Preview",className:s.previewMedia}),e.jsx("button",{type:"button",onClick:M,className:s.removeMedia,children:e.jsx(x,{size:16})})]}):p?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:`/api/img/${p}`,alt:"Current",className:s.previewMedia}),e.jsx("button",{type:"button",onClick:M,className:s.removeMedia,children:e.jsx(x,{size:16})})]}):null}):e.jsxs("label",{htmlFor:"image-upload",className:s.uploadButton,children:[e.jsx(W,{size:20}),e.jsx("span",{children:"Загрузить изображение"})]})]})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.label,children:"Видео обзор"}),e.jsxs("div",{className:s.fileUploadSection,children:[e.jsx("input",{type:"file",accept:"video/*",onChange:E,className:s.hiddenInput,id:"video-upload"}),h||l?e.jsx("div",{className:s.mediaPreview,children:l?e.jsxs(e.Fragment,{children:[e.jsx("video",{controls:!0,className:s.previewMedia,children:e.jsx("source",{src:URL.createObjectURL(l),type:"video/mp4"})}),e.jsx("button",{type:"button",onClick:I,className:s.removeMedia,children:e.jsx(x,{size:16})})]}):h?e.jsxs(e.Fragment,{children:[e.jsx("video",{controls:!0,className:s.previewMedia,children:e.jsx("source",{src:`/api/video/${h}`,type:"video/mp4"})}),e.jsx("button",{type:"button",onClick:I,className:s.removeMedia,children:e.jsx(x,{size:16})})]}):null}):e.jsxs("label",{htmlFor:"video-upload",className:s.uploadButton,children:[e.jsx(K,{size:20}),e.jsx("span",{children:"Загрузить видео"})]})]})]})]}),e.jsxs("div",{className:s.section,children:[e.jsx("div",{className:s.sectionHeader,children:e.jsx("h3",{className:s.sectionTitle,children:"Характеристики"})}),e.jsxs("div",{className:s.featuresSection,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{className:s.label,children:"Добавить характеристику"}),e.jsxs("select",{className:s.select,onChange:O,value:"",children:[e.jsx("option",{value:"",children:"Выберите характеристику..."}),y.map(t=>e.jsx("option",{value:t.key,disabled:u.includes(t.key),children:t.label},t.key))]})]}),e.jsxs("div",{className:s.selectedFeatures,children:[u.map(t=>{const a=y.find(o=>o.key===t);return e.jsxs("div",{className:s.featureChip,children:[e.jsx("span",{className:s.featureLabel,children:a?.label}),e.jsx("button",{type:"button",className:s.removeFeature,onClick:()=>B(t),children:e.jsx(x,{size:14})})]},t)}),u.length===0&&e.jsx("div",{className:s.noFeatures,children:"Характеристики не выбраны"})]})]})]})]})]})})]})});export{ze as default};
