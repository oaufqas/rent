import{c as X,o as q,r as l,j as e,m as _,i as J,X as R}from"./index-C-KVzDfL.js";import{a as K}from"./adminStore-CQx7drL5.js";import{B as P}from"./Button-DNnCRmfV.js";import{M as Q}from"./Modal-2Jv52JHA.js";import{T as W}from"./TransactionModal-DCscuvcS.js";import{f as N}from"./formatters-DNE1yS1Z.js";import{f as T}from"./dateUtils-S97u1aLj.js";import{E as $}from"./eye-BDLj4RTa.js";import{C as k}from"./check-gJirIFs8.js";import"./AccountService-BxV9YHVG.js";/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],Z=X("download",Y),ee="_transactionManagement_1vivw_1",se="_header_1vivw_11",te="_title_1vivw_27",ae="_subtitle_1vivw_43",ie="_stats_1vivw_57",ne="_statCard_1vivw_71",oe="_statValue_1vivw_99",le="_statLabel_1vivw_115",ce="_controls_1vivw_129",re="_search_1vivw_145",de="_searchIcon_1vivw_159",me="_searchInput_1vivw_177",ve="_filters_1vivw_225",he="_filterGroup_1vivw_239",_e="_filterSelect_1vivw_251",pe="_tableContainer_1vivw_319",ue="_table_1vivw_319",be="_tableRow_1vivw_385",je="_transactionId_1vivw_403",xe="_userInfo_1vivw_415",we="_avatar_1vivw_427",fe="_userEmail_1vivw_455",ye="_type_1vivw_471",Ne="_status_1vivw_471",Te="_warning_1vivw_497",ge="_success_1vivw_509",Ie="_error_1vivw_521",Ce="_amount_1vivw_533",Se="_method_1vivw_545",Le="_date_1vivw_557",Re="_actions_1vivw_569",$e="_actionBtn_1vivw_579",ke="_reject_1vivw_621",Ue="_loading_1vivw_631",Ae="_loadingSpinner_1vivw_653",Ee="_spin_1vivw_1",Ve="_emptyState_1vivw_683",Me="_emptyContent_1vivw_699",Be="_emptyTitle_1vivw_707",ze="_emptyText_1vivw_723",De="_mobileTransactions_1vivw_743",Fe="_mobileTransactionCard_1vivw_755",Oe="_mobileTransactionHeader_1vivw_775",Ge="_mobileTransactionId_1vivw_789",He="_mobileUserInfo_1vivw_803",Xe="_mobileAvatar_1vivw_817",qe="_mobileUserEmail_1vivw_845",Je="_mobileTransactionInfo_1vivw_857",Ke="_mobileInfoRow_1vivw_869",Pe="_mobileInfoLabel_1vivw_893",Qe="_mobileInfoValue_1vivw_905",We="_mobileType_1vivw_919",Ye="_mobileAmount_1vivw_937",Ze="_mobileStatus_1vivw_947",es="_mobileActions_1vivw_967",s={transactionManagement:ee,header:se,title:te,subtitle:ae,stats:ie,statCard:ne,statValue:oe,statLabel:le,controls:ce,search:re,searchIcon:de,searchInput:me,filters:ve,filterGroup:he,filterSelect:_e,tableContainer:pe,table:ue,tableRow:be,transactionId:je,userInfo:xe,avatar:we,userEmail:fe,type:ye,status:Ne,warning:Te,success:ge,error:Ie,amount:Ce,method:Se,date:Le,actions:Re,actionBtn:$e,reject:ke,loading:Ue,loadingSpinner:Ae,spin:Ee,emptyState:Ve,emptyContent:Me,emptyTitle:Be,emptyText:ze,mobileTransactions:De,mobileTransactionCard:Fe,mobileTransactionHeader:Oe,mobileTransactionId:Ge,mobileUserInfo:He,mobileAvatar:Xe,mobileUserEmail:qe,mobileTransactionInfo:Je,mobileInfoRow:Ke,mobileInfoLabel:Pe,mobileInfoValue:Qe,mobileType:We,mobileAmount:Ye,mobileStatus:Ze,mobileActions:es},ms=q(()=>{const{transactions:U,loading:g,fetchTransactions:d,approveTransaction:A,rejectTransaction:E}=K,[p,V]=l.useState("deposit"),[u,M]=l.useState("pending"),[b,B]=l.useState(""),[I,z]=l.useState(null),[D,m]=l.useState(!1),[F,v]=l.useState(!1);l.useEffect(()=>{d()},[d]);const i=U.filter(t=>{const a=t.id?.toString().includes(b)||t.user?.email?.toLowerCase().includes(b.toLowerCase()),c=p==="all"||t.type===p,r=u==="all"||t.status===u;return c&&r&&a}),C=t=>({pending:"warning",completed:"success",cancelled:"error",rejected:"error"})[t]||"secondary",j=t=>({pending:"Ожидание",completed:"Завершено",cancelled:"Отменено",rejected:"Отклонено"})[t]||t,x=t=>t==="deposit"?"Пополнение баланса":"Оплата аренды",S=t=>({balance:"Баланс",bank_transfer:"Банковский перевод",crypto:"Криптовалюта"})[t]||t,w=async t=>{v(!0);try{await A(t),m(!1),await d()}catch{alert("Ошибка при подтверждении транзакции")}finally{v(!1)}},f=async t=>{const a=prompt("Причина отклонения:");if(a){v(!0);try{await E(t,a),m(!1),await d()}catch{alert("Ошибка при отклонении транзакции")}finally{v(!1)}}},L=t=>{z(t),m(!0)},O=async t=>{try{const a=await fetch(`/api/admin/checks/${t}`,{method:"GET",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(a.ok){const c=await a.blob(),r=window.URL.createObjectURL(c),o=document.createElement("a");o.href=r,o.download=t,document.body.appendChild(o),o.click(),window.URL.revokeObjectURL(r),document.body.removeChild(o)}else alert("Ошибка при скачивании чека")}catch(a){console.error("Error downloading check:",a),alert("Ошибка при скачивании чека")}},G=()=>{const t=["ID","Пользователь","Тип","Сумма","Статус","Метод","Дата"],a=i.map(n=>[n.id,n.User?.email,x(n.type),n.amount,j(n.status),S(n.method),T(n.createdAt)]),c=[t,...a].map(n=>n.map(H=>`"${H}"`).join(",")).join(`
`),r=new Blob([c],{type:"text/csv"}),o=URL.createObjectURL(r),y=document.createElement("a");y.href=o,y.download=`transactions_${new Date().toISOString().split("T")[0]}.csv`,y.click(),URL.revokeObjectURL(o)},h={totalVolume:i.reduce((t,a)=>t+(a.type==="deposit"?a.amount:0),0),totalTransactions:i.length,pendingCount:i.filter(t=>t.status==="pending").length,successRate:i.length>0?(i.filter(t=>t.status==="completed").length/i.length*100).toFixed(1):0};return e.jsxs(_.div,{initial:{opacity:0},animate:{opacity:1},className:s.transactionManagement,children:[e.jsxs("div",{className:s.header,children:[e.jsxs("div",{children:[e.jsx("h1",{className:s.title,children:"Управление балансом пользователей"}),e.jsx("p",{className:s.subtitle,children:"Просмотр и управление финансовыми операциями"})]}),e.jsxs(P,{variant:"primary",onClick:G,children:[e.jsx(Z,{size:16}),"Экспорт"]})]}),e.jsxs("div",{className:s.stats,children:[e.jsxs("div",{className:s.statCard,children:[e.jsx("div",{className:s.statValue,children:N(h.totalVolume)}),e.jsx("div",{className:s.statLabel,children:"Общий объем"})]}),e.jsxs("div",{className:s.statCard,children:[e.jsx("div",{className:s.statValue,children:h.totalTransactions}),e.jsx("div",{className:s.statLabel,children:"Всего транзакций"})]}),e.jsxs("div",{className:s.statCard,children:[e.jsx("div",{className:s.statValue,children:h.pendingCount}),e.jsx("div",{className:s.statLabel,children:"Ожидают проверки"})]}),e.jsxs("div",{className:s.statCard,children:[e.jsxs("div",{className:s.statValue,children:[h.successRate,"%"]}),e.jsx("div",{className:s.statLabel,children:"Успешных операций"})]})]}),e.jsxs("div",{className:s.controls,children:[e.jsxs("div",{className:s.search,children:[e.jsx(J,{size:20,className:s.searchIcon}),e.jsx("input",{type:"text",placeholder:"Поиск транзакций...",className:s.searchInput,value:b,onChange:t=>B(t.target.value)})]}),e.jsx("div",{className:s.filters,children:e.jsxs("div",{className:s.filterGroup,children:[e.jsxs("select",{className:s.filterSelect,value:p,onChange:t=>V(t.target.value),children:[e.jsx("option",{value:"all",children:"Все типы транзакций"}),e.jsx("option",{value:"deposit",children:"Пополнение баланса"}),e.jsx("option",{value:"payment",children:"Оплата аренды"})]}),e.jsxs("select",{className:s.filterSelect,value:u,onChange:t=>M(t.target.value),children:[e.jsx("option",{value:"all",children:"Все статусы"}),e.jsx("option",{value:"pending",children:"Ожидание"}),e.jsx("option",{value:"completed",children:"Завершен"}),e.jsx("option",{value:"cancelled",children:"Отменен"})]})]})})]}),e.jsx("div",{className:s.tableContainer,children:g?e.jsx("div",{className:s.loading,children:"Загрузка транзакций..."}):e.jsxs("table",{className:s.table,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID транзакции"}),e.jsx("th",{children:"Пользователь"}),e.jsx("th",{children:"Тип"}),e.jsx("th",{children:"Сумма"}),e.jsx("th",{children:"Статус"}),e.jsx("th",{children:"Дата создания"}),e.jsx("th",{children:"Действия"})]})}),e.jsx("tbody",{children:i.map((t,a)=>e.jsxs(_.tr,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:a*.1},className:s.tableRow,children:[e.jsxs("td",{className:s.transactionId,children:["#",t.id]}),e.jsx("td",{children:e.jsxs("div",{className:s.userInfo,children:[e.jsx("div",{className:s.avatar,children:t.user?.email?.charAt(0).toUpperCase()||"U"}),e.jsx("span",{children:t.user?.email||"Пользователь удален"})]})}),e.jsx("td",{children:e.jsx("span",{className:`${s.type} ${s.primary}`,children:x(t.type)})}),e.jsxs("td",{className:`${s.amount} ${s.primary}`,children:[t.type==="deposit"?"+":"-",N(t.amount)]}),e.jsx("td",{children:e.jsx("span",{className:`${s.status} ${s[C(t.status)]}`,children:j(t.status)})}),e.jsx("td",{className:s.date,children:T(t.createdAt)}),e.jsx("td",{children:e.jsxs("div",{className:s.actions,children:[e.jsx("button",{onClick:()=>L(t),className:s.actionBtn,title:"Просмотр",children:e.jsx($,{size:16})}),t.status==="pending"&&t.type==="deposit"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>w(t.id),className:s.actionBtn,title:"Подтвердить",children:e.jsx(k,{size:16})}),e.jsx("button",{onClick:()=>f(t.id),className:`${s.actionBtn} ${s.reject}`,title:"Отклонить",children:e.jsx(R,{size:16})})]})]})})]},t.id))})]})}),e.jsx("div",{className:s.mobileTransactions,children:i.map((t,a)=>e.jsxs(_.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:a*.1},className:s.mobileTransactionCard,children:[e.jsxs("div",{className:s.mobileTransactionHeader,children:[e.jsxs("div",{className:s.mobileTransactionId,children:["#",t.id]}),e.jsx("span",{className:`${s.mobileStatus} ${s[C(t.status)]}`,children:j(t.status)})]}),e.jsxs("div",{className:s.mobileUserInfo,children:[e.jsx("div",{className:s.mobileAvatar,children:t.user?.email?.charAt(0).toUpperCase()||"U"}),e.jsx("span",{className:s.mobileUserEmail,children:t.user?.email||"Пользователь удален"})]}),e.jsxs("div",{className:s.mobileTransactionInfo,children:[e.jsxs("div",{className:s.mobileInfoRow,children:[e.jsx("span",{className:s.mobileInfoLabel,children:"Тип:"}),e.jsx("span",{className:`${s.mobileType} ${s.primary}`,children:x(t.type)})]}),e.jsxs("div",{className:s.mobileInfoRow,children:[e.jsx("span",{className:s.mobileInfoLabel,children:"Сумма:"}),e.jsxs("span",{className:`${s.mobileAmount} ${s.primary}`,children:[t.type==="deposit"?"+":"-",N(t.amount)]})]}),e.jsxs("div",{className:s.mobileInfoRow,children:[e.jsx("span",{className:s.mobileInfoLabel,children:"Дата:"}),e.jsx("span",{className:s.mobileInfoValue,children:T(t.createdAt)})]}),e.jsxs("div",{className:s.mobileInfoRow,children:[e.jsx("span",{className:s.mobileInfoLabel,children:"Метод:"}),e.jsx("span",{className:s.mobileInfoValue,children:S(t.method)})]})]}),e.jsxs("div",{className:s.mobileActions,children:[e.jsxs("button",{onClick:()=>L(t),className:s.actionBtn,title:"Просмотр",children:[e.jsx($,{size:16}),"Детали"]}),t.status==="pending"&&t.type==="deposit"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>w(t.id),className:s.actionBtn,title:"Подтвердить",children:[e.jsx(k,{size:16}),"Подтвердить"]}),e.jsxs("button",{onClick:()=>f(t.id),className:`${s.actionBtn} ${s.reject}`,title:"Отклонить",children:[e.jsx(R,{size:16}),"Отклонить"]})]})]})]},t.id))}),e.jsx(Q,{isOpen:D,onClose:()=>m(!1),title:`Транзакция #${I?.id}`,size:"large",children:e.jsx(W,{transaction:I,onApprove:w,onReject:f,onDownloadCheck:O,loading:F})}),i.length===0&&!g&&e.jsx(_.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:s.emptyState,children:e.jsxs("div",{className:s.emptyContent,children:[e.jsx("h3",{className:s.emptyTitle,children:"Транзакции не найдены"}),e.jsx("p",{className:s.emptyText,children:"Попробуйте изменить параметры фильтрации"})]})})]})});export{ms as default};
