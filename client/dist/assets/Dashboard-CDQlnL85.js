import{c as $,j as e,m as o,o as se,r as l,l as N,U as C,G as S,n as g}from"./index-C-KVzDfL.js";import{a as m}from"./adminStore-CQx7drL5.js";import{M as P}from"./Modal-2Jv52JHA.js";import{T as ne}from"./TransactionModal-DCscuvcS.js";import{O as ae}from"./OrderModal-Q7Q3AQCq.js";import{B as L}from"./Button-DNnCRmfV.js";import{f as O}from"./formatters-DNE1yS1Z.js";import{f as A}from"./dateUtils-S97u1aLj.js";import{E as R}from"./eye-BDLj4RTa.js";import"./AccountService-BxV9YHVG.js";import"./check-gJirIFs8.js";/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],te=$("trending-down",ie);/**
 * @license lucide-react v0.552.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],oe=$("trending-up",ce),le="_card_3lzm2_1",de="_primary_3lzm2_41",re="_success_3lzm2_49",me="_warning_3lzm2_57",he="_info_3lzm2_65",_e="_header_3lzm2_73",pe="_icon_3lzm2_87",ue="_stats_3lzm2_109",xe="_value_3lzm2_123",je="_change_3lzm2_137",ge="_positive_3lzm2_157",ve="_negative_3lzm2_167",ye="_title_3lzm2_177",c={card:le,primary:de,success:re,warning:me,info:he,header:_e,icon:pe,stats:ue,value:xe,change:je,positive:ge,negative:ve,title:ye},Ne=({title:t,value:u,change:_,icon:v,color:y="primary"})=>{const d=_>=0;return e.jsxs(o.div,{whileHover:{y:-5,scale:1.02},className:`${c.card} ${c[y]}`,children:[e.jsxs("div",{className:c.header,children:[e.jsx("div",{className:c.icon,children:e.jsx(v,{size:24})}),e.jsxs("div",{className:c.stats,children:[e.jsx("span",{className:c.value,children:u}),e.jsxs("div",{className:`${c.change} ${d?c.positive:c.negative}`,children:[d?e.jsx(oe,{size:16}):e.jsx(te,{size:16}),e.jsxs("span",{children:[Math.abs(_),"%"]})]})]})]}),e.jsx("h3",{className:c.title,children:t})]})},we="_dashboard_17zhs_1",ze="_header_17zhs_9",fe="_title_17zhs_17",Te="_subtitle_17zhs_31",be="_pendingSection_17zhs_47",ke="_sectionHeader_17zhs_63",Ce="_sectionTitle_17zhs_71",Se="_sectionSubtitle_17zhs_85",Pe="_pendingGrid_17zhs_97",Le="_pendingColumn_17zhs_109",Oe="_columnTitle_17zhs_119",Ae="_pendingList_17zhs_143",Re="_pendingItem_17zhs_157",$e="_itemHeader_17zhs_181",qe="_itemId_17zhs_195",Me="_itemStatus_17zhs_207",Ie="_itemDetails_17zhs_227",Ve="_detailRow_17zhs_241",De="_detailLabel_17zhs_253",Ue="_detailValue_17zhs_263",Ge="_amountPositive_17zhs_277",He="_itemFooter_17zhs_325",Ee="_itemTime_17zhs_341",Be="_quickActionsSection_17zhs_369",Fe="_quickActions_17zhs_369",Je="_quickAction_17zhs_369",Ke="_noPending_17zhs_449",Qe="_noPendingContent_17zhs_467",We="_noPendingTitle_17zhs_491",Xe="_noPendingText_17zhs_505",Ye="_statsGrid_17zhs_601",Ze="_viewButton_17zhs_873",s={dashboard:we,header:ze,title:fe,subtitle:Te,pendingSection:be,sectionHeader:ke,sectionTitle:Ce,sectionSubtitle:Se,pendingGrid:Pe,pendingColumn:Le,columnTitle:Oe,pendingList:Ae,pendingItem:Re,itemHeader:$e,itemId:qe,itemStatus:Me,itemDetails:Ie,detailRow:Ve,detailLabel:De,detailValue:Ue,amountPositive:Ge,itemFooter:He,itemTime:Ee,quickActionsSection:Be,quickActions:Fe,quickAction:Je,noPending:Ke,noPendingContent:Qe,noPendingTitle:We,noPendingText:Xe,statsGrid:Ye,viewButton:Ze},ms=se(()=>{const{dashboardStats:t,loading:u,fetchDashboardStats:_,fetchPendingOrders:v,fetchPendingTransactions:y}=m,[d,q]=l.useState([]),[x,M]=l.useState([]),[w,I]=l.useState(null),[z,V]=l.useState(null),[D,h]=l.useState(!1),[U,j]=l.useState(!1),[f,i]=l.useState(!1);l.useEffect(()=>{_(),r()},[_]);const r=async()=>{try{const[n,a]=await Promise.all([v(),y()]);q(n.data||[]),M(a.data||[])}catch(n){console.error("Error loading pending items:",n)}},G=async n=>{i(!0);try{await m.approveOrder(n),await r(),h(!1)}catch{alert("Ошибка при подтверждении заказа")}finally{i(!1)}},H=async n=>{i(!0);try{await m.rejectOrder(n),await r(),h(!1)}catch{alert("Ошибка при отклонении заказа")}finally{i(!1)}},E=async n=>{i(!0);try{await m.verifyUser(n),await r(),h(!1)}catch{alert("Ошибка при верификации пользователя")}finally{i(!1)}},B=async n=>{i(!0);try{await m.completeOrder(n),await r(),h(!1)}catch{alert("Ошибка при завершении заказа")}finally{i(!1)}},F=async n=>{i(!0);try{await m.approveTransaction(n),await r(),j(!1)}catch{alert("Ошибка при подтверждении транзакции")}finally{i(!1)}},J=async n=>{i(!0);try{await m.rejectTransaction(n),await r(),j(!1)}catch{alert("Ошибка при отклонении транзакции")}finally{i(!1)}},T=async n=>{try{const a=await fetch(`/api/admin/checks/${n}`,{method:"GET",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(a.ok){const ee=await a.blob(),k=window.URL.createObjectURL(ee),p=document.createElement("a");p.href=k,p.download=n,document.body.appendChild(p),p.click(),window.URL.revokeObjectURL(k),document.body.removeChild(p)}else alert("Ошибка при скачивании чека")}catch(a){console.error("Error downloading check:",a),alert("Ошибка при скачивании чека")}},K=n=>{const a=`/api/admin/checks/${n}`;window.open(a,"_blank")},Q=n=>{I(n),h(!0)},W=n=>{V(n),j(!0)},X=n=>({pending:"Ожидает подтверждения",paid:"Оплачен, проверка пользователя",verified:"Пользователь проверен"})[n]||n,Y=n=>({bank_transfer:"Банковский перевод",crypto:"Криптовалюта"})[n]||n,Z=[{title:"Новые заказы",value:t?.newOrders||0,change:t?.orderChange||0,icon:N,color:"primary"},{title:"Новые пользователи",value:t?.newUsers||0,change:t?.userChange||0,icon:C,color:"success"},{title:"Активные аренды",value:t?.activeRentals||0,change:t?.rentalChange||0,icon:S,color:"warning"},{title:"Общий доход",value:`${t?.totalRevenue?.toLocaleString()||0} ₽`,change:t?.revenueChange||0,icon:g,color:"info"}],b=d.length>0||x.length>0;return e.jsxs(o.div,{initial:{opacity:0},animate:{opacity:1},className:s.dashboard,children:[e.jsxs("div",{className:s.header,children:[e.jsx("h1",{className:s.title,children:"Дашборд"}),e.jsx("p",{className:s.subtitle,children:"Обзор статистики и активности"})]}),e.jsx(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:s.statsGrid,children:Z.map((n,a)=>e.jsx(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:a*.1},children:e.jsx(Ne,{...n,loading:u})},n.title))}),b&&e.jsxs(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:s.pendingSection,children:[e.jsxs("div",{className:s.sectionHeader,children:[e.jsx("h2",{className:s.sectionTitle,children:"Требуют внимания"}),e.jsx("p",{className:s.sectionSubtitle,children:"Заказы и заявки на пополнение, ожидающие проверки"})]}),e.jsxs("div",{className:s.pendingGrid,children:[d.length>0&&e.jsxs("div",{className:s.pendingColumn,children:[e.jsxs("h3",{className:s.columnTitle,children:[e.jsx(N,{size:20}),"Заказы в ожидании (",d.length,")"]}),e.jsx("div",{className:s.pendingList,children:d.map(n=>e.jsxs(o.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},className:s.pendingItem,children:[e.jsxs("div",{className:s.itemHeader,children:[e.jsxs("span",{className:s.itemId,children:["Заказ #",n.id]}),e.jsx("span",{className:s.itemStatus,children:X(n.status)})]}),e.jsxs("div",{className:s.itemDetails,children:[e.jsxs("div",{className:s.detailRow,children:[e.jsx("span",{className:s.detailLabel,children:"Пользователь:"}),e.jsx("span",{className:s.detailValue,children:n.user?.email})]}),e.jsxs("div",{className:s.detailRow,children:[e.jsx("span",{className:s.detailLabel,children:"Сумма:"}),e.jsx("span",{className:s.detailValue,children:O(n.amount)})]}),e.jsxs("div",{className:s.detailRow,children:[e.jsx("span",{className:s.detailLabel,children:"Период:"}),e.jsxs("span",{className:s.detailValue,children:[n.rentPeriod," ч"]})]})]}),e.jsxs("div",{className:s.itemFooter,children:[e.jsx("span",{className:s.itemTime,children:A(n.createdAt)}),e.jsxs(L,{variant:"secondary",size:"small",onClick:()=>Q(n),className:s.viewButton,children:[e.jsx(R,{size:14}),"Подробнее"]})]})]},n.id))})]}),x.length>0&&e.jsxs("div",{className:s.pendingColumn,children:[e.jsxs("h3",{className:s.columnTitle,children:[e.jsx(g,{size:20}),"Заявки на пополнение (",x.length,")"]}),e.jsx("div",{className:s.pendingList,children:x.map(n=>e.jsxs(o.div,{initial:{opacity:0,x:10},animate:{opacity:1,x:0},className:s.pendingItem,children:[e.jsxs("div",{className:s.itemHeader,children:[e.jsxs("span",{className:s.itemId,children:["Транзакция #",n.id]}),e.jsx("span",{className:s.itemStatus,children:"Ожидает подтверждения"})]}),e.jsxs("div",{className:s.itemDetails,children:[e.jsxs("div",{className:s.detailRow,children:[e.jsx("span",{className:s.detailLabel,children:"Пользователь:"}),e.jsx("span",{className:s.detailValue,children:n.user?.email})]}),e.jsxs("div",{className:s.detailRow,children:[e.jsx("span",{className:s.detailLabel,children:"Сумма:"}),e.jsxs("span",{className:`${s.detailValue} ${s.amountPositive}`,children:["+",O(n.amount)]})]}),e.jsxs("div",{className:s.detailRow,children:[e.jsx("span",{className:s.detailLabel,children:"Метод:"}),e.jsx("span",{className:s.detailValue,children:Y(n.method)})]})]}),e.jsxs("div",{className:s.itemFooter,children:[e.jsx("span",{className:s.itemTime,children:A(n.createdAt)}),e.jsxs(L,{variant:"secondary",size:"small",onClick:()=>W(n),className:s.viewButton,children:[e.jsx(R,{size:14}),"Подробнее"]})]})]},n.id))})]})]})]}),e.jsxs(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:s.quickActionsSection,children:[e.jsx("div",{className:s.sectionHeader,children:e.jsx("h2",{className:s.sectionTitle,children:"Быстрые действия"})}),e.jsxs("div",{className:s.quickActions,children:[e.jsxs("button",{className:s.quickAction,onClick:()=>window.location.href="/admin/accounts",children:[e.jsx(S,{size:24}),e.jsx("span",{children:"Управление аккаунтами"})]}),e.jsxs("button",{className:s.quickAction,onClick:()=>window.location.href="/admin/users",children:[e.jsx(C,{size:24}),e.jsx("span",{children:"Управление пользователями"})]}),e.jsxs("button",{className:s.quickAction,onClick:()=>window.location.href="/admin/transactions",children:[e.jsx(g,{size:24}),e.jsx("span",{children:"Просмотр транзакций"})]}),e.jsxs("button",{className:s.quickAction,onClick:()=>window.location.href="/admin/orders",children:[e.jsx(N,{size:24}),e.jsx("span",{children:"Обработка заказов"})]}),e.jsxs("button",{className:s.quickAction,onClick:()=>window.location.href="/admin/paymethods",children:[e.jsx(g,{size:24}),e.jsx("span",{children:"Методы оплаты"})]})]})]}),e.jsx(P,{isOpen:D,onClose:()=>h(!1),title:`Заказ #${w?.id}`,size:"large",children:e.jsx(ae,{order:w,onApprove:G,onReject:H,onVerifyUser:E,onComplete:B,onDownloadCheck:T,loading:f})}),e.jsx(P,{isOpen:U,onClose:()=>j(!1),title:`Транзакция #${z?.id}`,size:"large",children:e.jsx(ne,{transaction:z,onApprove:F,onReject:J,onDownloadCheck:T,onViewCheck:K,loading:f})}),!b&&!u&&e.jsx(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:s.noPending,children:e.jsxs("div",{className:s.noPendingContent,children:[e.jsx("h3",{className:s.noPendingTitle,children:"Все задачи выполнены!"}),e.jsx("p",{className:s.noPendingText,children:"Нет заказов или заявок на пополнение, требующих вашего внимания"})]})})]})});export{ms as default};
