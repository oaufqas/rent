import{o as $,r as i,j as e,m as _,i as D}from"./index-BMjTxWI5.js";import{a as P}from"./adminStore-69BTUR3l.js";import{B as o}from"./Button-D0cEhXue.js";import{M as H}from"./Modal-DaGtJTxd.js";import{O as F}from"./OrderModal-DwZMdF7C.js";import{f as g}from"./formatters-DNE1yS1Z.js";import{f as O}from"./dateUtils-S97u1aLj.js";import{E as S}from"./eye-Bw0ziA_o.js";import"./AccountService-vNVs7x2E.js";import"./check-DLZoD-Wd.js";const G="_orderManagement_ohre4_1",q="_header_ohre4_11",J="_headerContent_ohre4_19",K="_approveBtn_ohre4_27",Q="_verifyBtn_ohre4_49",W="_completeBtn_ohre4_71",X="_rejectBtn_ohre4_93",Y="_forceCompleteBtn_ohre4_115",Z="_secondaryBtn_ohre4_139",ee="_title_ohre4_161",se="_subtitle_ohre4_177",te="_viewBtn_ohre4_193",ae="_controls_ohre4_231",ne="_search_ohre4_247",oe="_searchIcon_ohre4_261",le="_searchInput_ohre4_279",re="_filters_ohre4_327",ie="_filterSelect_ohre4_341",ce="_tableContainer_ohre4_409",de="_table_ohre4_409",me="_tableRow_ohre4_475",he="_orderId_ohre4_493",_e="_userInfo_ohre4_505",pe="_avatar_ohre4_517",ue="_userEmail_ohre4_545",je="_accountTitle_ohre4_553",xe="_rentPeriod_ohre4_569",be="_amount_ohre4_579",fe="_date_ohre4_591",ve="_status_ohre4_605",ye="_warning_ohre4_629",Ne="_info_ohre4_641",Ie="_success_ohre4_653",we="_secondary_ohre4_139",Ce="_error_ohre4_677",ge="_actions_ohre4_691",Oe="_loading_ohre4_705",Se="_loadingSpinner_ohre4_727",Be="_spin_ohre4_1",Ue="_emptyState_ohre4_757",Re="_emptyContent_ohre4_773",Te="_emptyIcon_ohre4_781",Ae="_emptyTitle_ohre4_793",Ee="_emptyText_ohre4_809",ke="_mobileOrders_ohre4_825",Le="_mobileOrderCard_ohre4_837",Me="_mobileOrderHeader_ohre4_857",ze="_mobileOrderId_ohre4_871",Ve="_mobileStatus_ohre4_885",$e="_mobileOrderInfo_ohre4_905",De="_mobileInfoRow_ohre4_917",Pe="_mobileInfoLabel_ohre4_941",He="_mobileInfoValue_ohre4_953",Fe="_mobileUserInfo_ohre4_967",Ge="_mobileAvatar_ohre4_981",qe="_mobileUserEmail_ohre4_1009",Je="_mobileActions_ohre4_1021",s={orderManagement:G,header:q,headerContent:J,approveBtn:K,verifyBtn:Q,completeBtn:W,rejectBtn:X,forceCompleteBtn:Y,secondaryBtn:Z,title:ee,subtitle:se,viewBtn:te,controls:ae,search:ne,searchIcon:oe,searchInput:le,filters:re,filterSelect:ie,tableContainer:ce,table:de,tableRow:me,orderId:he,userInfo:_e,avatar:pe,userEmail:ue,accountTitle:je,rentPeriod:xe,amount:be,date:fe,status:ve,warning:ye,info:Ne,success:Ie,secondary:we,error:Ce,actions:ge,loading:Oe,loadingSpinner:Se,spin:Be,emptyState:Ue,emptyContent:Re,emptyIcon:Te,emptyTitle:Ae,emptyText:Ee,mobileOrders:ke,mobileOrderCard:Le,mobileOrderHeader:Me,mobileOrderId:ze,mobileStatus:Ve,mobileOrderInfo:$e,mobileInfoRow:De,mobileInfoLabel:Pe,mobileInfoValue:He,mobileUserInfo:Fe,mobileAvatar:Ge,mobileUserEmail:qe,mobileActions:Je},ns=$(()=>{const{orders:B,loading:j,fetchOrders:l,approveOrder:U,rejectOrder:R,verifyUser:T,completeOrder:A}=P,[c,E]=i.useState(""),[d,k]=i.useState("pending"),[x,L]=i.useState(null),[M,r]=i.useState(!1),[z,n]=i.useState(!1);i.useEffect(()=>{l()},[l]);const p=B.filter(t=>{const a=t.id?.toString().includes(c)||t.user?.email?.toLowerCase().includes(c.toLowerCase()),u=d==="all"||t.status===d;return a&&u}),b=async t=>{n(!0);try{await U(t),r(!1),await l()}catch{alert("Ошибка при подтверждении заказа")}finally{n(!1)}},h=async t=>{n(!0);try{await R(t),r(!1),await l()}catch{alert("Ошибка при отклонении заказа")}finally{n(!1)}},f=async t=>{n(!0);try{await T(t),r(!1),await l()}catch{alert("Ошибка при верификации пользователя")}finally{n(!1)}},v=async t=>{n(!0);try{await A(t),r(!1),await l()}catch{alert("Ошибка при завершении заказа")}finally{n(!1)}},y=t=>{L(t),r(!0)},V=async t=>{try{const a=await fetch(`/api/admin/checks/${t}`,{method:"GET",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(a.ok){const u=await a.blob(),C=window.URL.createObjectURL(u),m=document.createElement("a");m.href=C,m.download=t,document.body.appendChild(m),m.click(),window.URL.revokeObjectURL(C),document.body.removeChild(m)}else alert("Ошибка при скачивании чека")}catch(a){console.error("Error downloading check:",a),alert("Ошибка при скачивании чека")}},N=t=>({pending:"warning",paid:"info",verified:"info",active:"success",completed:"secondary",cancelled:"error"})[t]||"secondary",I=t=>({pending:"Ожидание",paid:"Оплачен",active:"Активен",verified:"Проверка пользователя",completed:"Завершен",cancelled:"Отменен"})[t]||t,w=t=>{switch(t.status){case"pending":return e.jsxs(e.Fragment,{children:[e.jsx(o,{className:s.approveBtn,size:"small",onClick:()=>b(t.id),children:"Принять"}),e.jsx(o,{className:s.rejectBtn,size:"small",onClick:()=>h(t.id),children:"Отклонить"})]});case"paid":return e.jsx(o,{className:s.verifyBtn,size:"small",onClick:()=>f(t.id),children:"Проверить пользователя"});case"verified":return e.jsxs(e.Fragment,{children:[e.jsx(o,{className:s.completeBtn,size:"small",onClick:()=>v(t.id),children:"Выдать аккаунт"}),e.jsx(o,{className:s.rejectBtn,size:"small",onClick:()=>h(t.id),children:"Отклонить"})]});case"active":return e.jsx(o,{className:s.rejectBtn,size:"small",onClick:()=>h(t.id),children:"Принудительно завершить"});default:return null}};return e.jsxs(_.div,{initial:{opacity:0},animate:{opacity:1},className:s.orderManagement,children:[e.jsx("div",{className:s.header,children:e.jsxs("div",{className:s.headerContent,children:[e.jsx("h1",{className:s.title,children:"Управление заказами"}),e.jsx("p",{className:s.subtitle,children:"Просмотр и управление всеми заказами"})]})}),e.jsxs("div",{className:s.controls,children:[e.jsxs("div",{className:s.search,children:[e.jsx(D,{size:20,className:s.searchIcon}),e.jsx("input",{type:"text",placeholder:"Поиск по ID заказа или email пользователя...",className:s.searchInput,value:c,onChange:t=>E(t.target.value)})]}),e.jsx("div",{className:s.filters,children:e.jsxs("select",{className:s.filterSelect,value:d,onChange:t=>k(t.target.value),children:[e.jsx("option",{value:"all",children:"Все статусы"}),e.jsx("option",{value:"pending",children:"Ожидание"}),e.jsx("option",{value:"paid",children:"Оплачено"}),e.jsx("option",{value:"verified",children:"Проверка пользователя"}),e.jsx("option",{value:"active",children:"Активно"}),e.jsx("option",{value:"completed",children:"Завершено"}),e.jsx("option",{value:"cancelled",children:"Отменено"})]})})]}),e.jsx("div",{className:s.tableContainer,children:j?e.jsxs("div",{className:s.loading,children:[e.jsx("div",{className:s.loadingSpinner}),"Загрузка заказов..."]}):e.jsxs("table",{className:s.table,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID заказа"}),e.jsx("th",{children:"Пользователь"}),e.jsx("th",{children:"Аккаунт"}),e.jsx("th",{children:"Время"}),e.jsx("th",{children:"Стоимость"}),e.jsx("th",{children:"Статус"}),e.jsx("th",{children:"Дата"}),e.jsx("th",{children:"Действия"})]})}),e.jsx("tbody",{children:p.map((t,a)=>e.jsxs(_.tr,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:a*.1},className:s.tableRow,children:[e.jsxs("td",{className:s.orderId,children:["#",t.id]}),e.jsx("td",{children:e.jsxs("div",{className:s.userInfo,children:[e.jsx("div",{className:s.avatar,children:t.user?.email?.charAt(0).toUpperCase()||"U"}),e.jsx("span",{className:s.userEmail,children:t.user?.email||"Неизвестно"})]})}),e.jsx("td",{className:s.accountTitle,children:t.accountId?`#${t.account?.account_number}`:"Аккаунт удален"}),e.jsxs("td",{className:s.rentPeriod,children:[t.rentPeriod," ч"]}),e.jsx("td",{className:s.amount,children:g(t.amount)}),e.jsx("td",{children:e.jsx("span",{className:`${s.status} ${s[N(t.status)]}`,children:I(t.status)})}),e.jsx("td",{className:s.date,children:O(t.createdAt)}),e.jsx("td",{children:e.jsxs("div",{className:s.actions,children:[w(t),e.jsx(o,{onClick:()=>y(t),className:s.viewBtn,title:"Просмотр деталей",children:e.jsx(S,{size:16})})]})})]},t.id))})]})}),e.jsx("div",{className:s.mobileOrders,children:p.map((t,a)=>e.jsxs(_.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:a*.1},className:s.mobileOrderCard,children:[e.jsxs("div",{className:s.mobileOrderHeader,children:[e.jsxs("div",{className:s.mobileOrderId,children:["#",t.id]}),e.jsx("span",{className:`${s.mobileStatus} ${s[N(t.status)]}`,children:I(t.status)})]}),e.jsxs("div",{className:s.mobileUserInfo,children:[e.jsx("div",{className:s.mobileAvatar,children:t.user?.email?.charAt(0).toUpperCase()||"U"}),e.jsx("span",{className:s.mobileUserEmail,children:t.user?.email||"Неизвестно"})]}),e.jsxs("div",{className:s.mobileOrderInfo,children:[e.jsxs("div",{className:s.mobileInfoRow,children:[e.jsx("span",{className:s.mobileInfoLabel,children:"Аккаунт:"}),e.jsx("span",{className:s.mobileInfoValue,children:t.accountId?`#${t.account?.account_number}`:"Аккаунт удален"})]}),e.jsxs("div",{className:s.mobileInfoRow,children:[e.jsx("span",{className:s.mobileInfoLabel,children:"Время аренды:"}),e.jsxs("span",{className:s.mobileInfoValue,children:[t.rentPeriod," ч"]})]}),e.jsxs("div",{className:s.mobileInfoRow,children:[e.jsx("span",{className:s.mobileInfoLabel,children:"Стоимость:"}),e.jsx("span",{className:s.mobileInfoValue,children:g(t.amount)})]}),e.jsxs("div",{className:s.mobileInfoRow,children:[e.jsx("span",{className:s.mobileInfoLabel,children:"Дата:"}),e.jsx("span",{className:s.mobileInfoValue,children:O(t.createdAt)})]})]}),e.jsxs("div",{className:s.mobileActions,children:[w(t),e.jsx(o,{onClick:()=>y(t),className:s.viewBtn,title:"Просмотр деталей",children:e.jsx(S,{size:16})})]})]},t.id))}),e.jsx(H,{isOpen:M,onClose:()=>r(!1),title:`Заказ #${x?.id}`,size:"large",children:e.jsx(F,{order:x,onApprove:b,onReject:h,onVerifyUser:f,onComplete:v,onDownloadCheck:V,loading:z})}),p.length===0&&!j&&e.jsx(_.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:s.emptyState,children:e.jsxs("div",{className:s.emptyContent,children:[e.jsx("h3",{className:s.emptyTitle,children:c||d!=="all"?"Заказы не найдены":"Заказов пока нет"}),e.jsx("p",{className:s.emptyText,children:c||d!=="all"?"Попробуйте изменить параметры поиска":"Все новые заказы будут отображаться здесь"})]})})]})});export{ns as default};
