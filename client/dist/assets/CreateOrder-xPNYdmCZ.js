import{o as E,r as i,C as T,f as B,u as U,h as w,R as d,j as e,L,m as o,g as R,A as C}from"./index-BMjTxWI5.js";import{a as W}from"./accountStore-C6L7ROPf.js";import{o as q}from"./orderStore-DYeG6_Kd.js";import{S as $}from"./StatusBadge-DyHTHczb.js";import{B as z}from"./Button-D0cEhXue.js";import{I as D}from"./Input-kAJO1UCZ.js";import{P as G}from"./PriceCalculator-BbMmP8b7.js";import{O as V}from"./OrderTimeline-CDMCUv44.js";import{F as J}from"./FileUpload-yDFBY-bl.js";import"./AccountService-vNVs7x2E.js";import"./dateUtils-S97u1aLj.js";import"./usePriceCalculations-HJ7VHZks.js";import"./clock-DKQpXJuy.js";import"./check-DLZoD-Wd.js";const K="_createOrder_19825_1",Q="_container_19825_11",X="_loading_19825_23",Y="_header_19825_37",Z="_title_19825_45",ee="_content_19825_61",ae="_orderInfo_19825_73",te="_accountCard_19825_85",se="_accountDetails_19825_113",ne="_accountHeader_19825_123",ce="_accountNumber_19825_153",oe="_orderDetails_19825_165",re="_detailsList_19825_193",ie="_detail_19825_193",le="_totalPrice_19825_221",de="_orderForm_19825_233",me="_formTitle_19825_253",he="_error_19825_267",pe="_paymentSection_19825_285",ue="_paymentMethods_19825_299",_e="_paymentMethod_19825_299",ye="_balanceInfo_19825_361",xe="_balanceHeader_19825_379",je="_balanceComparison_19825_379",fe="_balanceAmount_19825_395",be="_orderAmount_19825_407",Me="_balanceWarning_19825_419",Ne="_balanceSuccess_19825_439",ge="_paymentDetails_19825_459",ve="_payMethods_19825_491",Pe="_payMethod_19825_491",Ce="_selected_19825_529",De="_payMethodName_19825_539",Ie="_payMethodInfo_19825_617",Se="_payMethodDetails_19825_645",ke="_checkUpload_19825_655",Ae="_uploadHint_19825_667",Oe="_submitButton_19825_679",He="_breadcrumbs_19825_727",a={createOrder:K,container:Q,loading:X,header:Y,title:Z,content:ee,orderInfo:ae,accountCard:te,accountDetails:se,accountHeader:ne,accountNumber:ce,orderDetails:oe,detailsList:re,detail:ie,totalPrice:le,orderForm:de,formTitle:me,error:he,paymentSection:pe,paymentMethods:ue,paymentMethod:_e,balanceInfo:ye,balanceHeader:xe,balanceComparison:je,balanceAmount:fe,orderAmount:be,balanceWarning:Me,balanceSuccess:Ne,paymentDetails:ge,payMethods:ve,payMethod:Pe,selected:Ce,payMethodName:De,payMethodInfo:Ie,payMethodDetails:Se,checkUpload:ke,uploadHint:Ae,submitButton:Oe,breadcrumbs:He},Je=E(()=>{const{store:x}=i.useContext(T),[j]=B(),l=U(),{fetchAccount:f}=W,{createOrder:I,loading:S}=q,{fetchBalance:b,balance:M,fetchPayMethods:N,payMethods:k}=w,[c,A]=i.useState(null),[s,m]=i.useState({verificationPlatform:"",userNameInPlatform:"",paymentMethod:"balance",selectedPayMethod:"",check:null}),[g,r]=i.useState(""),h=j.get("account"),p=parseInt(j.get("hours"))||3,u=c?c.price*p:0,_=M>=u,v=s.verificationPlatform&&s.userNameInPlatform&&s.paymentMethod&&(s.paymentMethod==="balance"?_:s.selectedPayMethod&&s.check);i.useEffect(()=>{window.scrollTo(0,0)},[]),i.useEffect(()=>{if(!x.isAuth){l(d.LOGIN);return}h?(async()=>{try{const t=await f(h);A(t),await b(),await N()}catch(t){console.error("Error loading account:",t),l(d.ACCOUNTS)}})():l(d.ACCOUNTS)},[h,x,l,f,N,b]);const y=n=>{m(t=>({...t,paymentMethod:n.target.value,selectedPayMethod:"",check:null})),r("")},O=n=>{m(t=>({...t,selectedPayMethod:n.target.value})),r("")},P=n=>{m(t=>({...t,[n.target.name]:n.target.value})),r("")},H=n=>{m(t=>({...t,check:n})),r("")},F=async n=>{if(n.preventDefault(),!v){r("Пожалуйста, укажите контакт для связи");return}try{const t=new FormData;t.append("accountId",c.id),t.append("rentPeriod",p),t.append("verificationPlatform",s.verificationPlatform),t.append("userNameInPlatform",s.userNameInPlatform),t.append("paymentMethod",s.paymentMethod),t.append("amount",u),s.paymentMethod!=="balance"&&t.append("selectedPayMethod",s.selectedPayMethod),s.check&&t.append("check",s.check),await I(t),l(d.ORDERS)}catch(t){console.error(t),r(t.response?.data?.message||"Ошибка создания заказа")}};return c?e.jsx(o.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:a.createOrder,children:e.jsxs("div",{className:a.container,children:[e.jsxs("nav",{className:a.breadcrumbs,children:[e.jsx("a",{href:d.HOME,children:"Главная"}),e.jsx("span",{children:"/"}),e.jsxs("a",{href:R.accountDetail(h),children:["Аккаунт #",c.id]}),e.jsx("span",{children:"/"}),e.jsx("span",{children:"Создание заказа"})]}),e.jsxs(o.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},className:a.header,children:[e.jsx("h1",{className:a.title,children:"Оформление заказа"}),e.jsx(V,{status:"pending",currentStep:0})]}),e.jsxs("div",{className:a.content,children:[e.jsxs(o.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:a.orderInfo,children:[e.jsxs("div",{className:a.accountCard,children:[e.jsx("img",{src:"/api/img/"+c.img,alt:c.title}),e.jsxs("div",{className:a.accountDetails,children:[e.jsxs("div",{className:a.accountHeader,children:[e.jsx("h3",{children:c.title}),e.jsx($,{status:c.status})]}),e.jsxs("p",{className:a.accountNumber,children:["#",c.account_number]})]})]}),e.jsxs("div",{className:a.orderDetails,children:[e.jsx("h4",{children:"Детали заказа"}),e.jsxs("div",{className:a.detailsList,children:[e.jsxs("div",{className:a.detail,children:[e.jsx("span",{children:"Время аренды:"}),e.jsxs("span",{children:[p," часов"]})]}),e.jsxs("div",{className:a.detail,children:[e.jsx("span",{children:"Цена за час:"}),e.jsxs("span",{children:[c.price," ₽"]})]}),e.jsxs("div",{className:a.detail,children:[e.jsx("span",{children:"Итого:"}),e.jsxs("span",{className:a.totalPrice,children:[u," ₽"]})]})]})]})]}),e.jsxs(o.form,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},onSubmit:F,className:a.orderForm,children:[e.jsx("h3",{className:a.formTitle,children:"Данные для заказа"}),g&&e.jsx("div",{className:a.error,children:g}),e.jsx(D,{label:"Платформа для проверки *",name:"verificationPlatform",value:s.verificationPlatform,onChange:P,placeholder:"Например Discord или Telegram",required:!0}),e.jsx(D,{label:"Ваш username на этой платформе *",name:"userNameInPlatform",value:s.userNameInPlatform,onChange:P,placeholder:"Ваш @юзернейм",required:!0}),e.jsxs("div",{className:a.paymentSection,children:[e.jsx("h4",{children:"Способ оплаты *"}),e.jsxs("div",{className:a.paymentMethods,children:[e.jsxs("label",{className:a.paymentMethod,children:[e.jsx("input",{type:"radio",name:"paymentMethod",value:"balance",checked:s.paymentMethod==="balance",onChange:y}),e.jsx("span",{children:"Баланс аккаунта"})]}),e.jsxs("label",{className:a.paymentMethod,children:[e.jsx("input",{type:"radio",name:"paymentMethod",value:"bank_transfer",checked:s.paymentMethod==="bank_transfer",onChange:y}),e.jsx("span",{children:"Банковский перевод"})]}),e.jsxs("label",{className:a.paymentMethod,children:[e.jsx("input",{type:"radio",name:"paymentMethod",value:"crypto",checked:s.paymentMethod==="crypto",onChange:y}),e.jsx("span",{children:"Криптовалюта"})]})]})]}),e.jsx(C,{children:s.paymentMethod==="balance"&&e.jsxs(o.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:a.balanceInfo,children:[e.jsxs("div",{className:a.balanceHeader,children:[e.jsx("span",{children:"Ваш баланс:"}),e.jsxs("span",{className:a.balanceAmount,children:[M," ₽"]})]}),e.jsxs("div",{className:a.balanceComparison,children:[e.jsx("span",{children:"Стоимость заказа:"}),e.jsxs("span",{className:a.orderAmount,children:[u," ₽"]})]}),!_&&e.jsx("div",{className:a.balanceWarning,children:"Недостаточно средств на балансе"}),_&&e.jsx("div",{className:a.balanceSuccess,children:"Достаточно средств для заказа"})]})}),e.jsx(C,{children:s.paymentMethod!=="balance"&&e.jsxs(o.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:a.paymentDetails,children:[e.jsx("h5",{children:"Выберите способ оплаты:"}),e.jsx("div",{className:a.payMethods,children:k.filter(n=>n.type===s.paymentMethod).map(n=>e.jsxs("label",{className:`${a.payMethod} ${s.selectedPayMethod==n.id?a.selected:""}`,children:[e.jsx("input",{type:"radio",name:"selectedPayMethod",value:n.id,onChange:O}),e.jsxs("div",{className:a.payMethodInfo,children:[e.jsx("span",{className:a.payMethodName,children:n.name}),e.jsx("span",{className:a.payMethodDetails,children:n.details})]})]},n.id))}),s.selectedPayMethod&&e.jsxs(o.div,{initial:{opacity:0},animate:{opacity:1},className:a.checkUpload,children:[e.jsx(J,{label:"Чек об оплате *",accept:"image/*,.pdf",onFileChange:H,required:!0}),e.jsx("p",{className:a.uploadHint,children:"Загрузите скриншот или фото чека об оплате"})]})]})}),e.jsx(G,{basePrice:c.price,hours:p}),e.jsx(z,{type:"submit",variant:"primary",size:"large",loading:S,disabled:!v,className:a.submitButton,children:"Подтвердить заказ"})]})]})]})}):e.jsx("div",{className:a.loading,children:e.jsx(L,{fullScreen:!0})})});export{Je as default};
