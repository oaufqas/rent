import{o as b,f as w,u as R,r as n,e as C,j as e,L as I,m as l,R as _,S as D}from"./index-BMjTxWI5.js";import"./accountStore-C6L7ROPf.js";import{o as E}from"./orderStore-DYeG6_Kd.js";import{r as L}from"./reviewStore-DwgeE85A.js";import"./adminStore-69BTUR3l.js";import{B as x}from"./Button-D0cEhXue.js";import{I as T}from"./Input-kAJO1UCZ.js";import"./AccountService-vNVs7x2E.js";const $="_createReview_xr6hh_1",F="_container_xr6hh_13",H="_loading_xr6hh_25",O="_header_xr6hh_39",k="_title_xr6hh_49",P="_subtitle_xr6hh_65",B="_content_xr6hh_77",q="_orderInfo_xr6hh_91",z="_orderCard_xr6hh_103",A="_orderDetails_xr6hh_145",M="_reviewForm_xr6hh_181",U="_formTitle_xr6hh_201",V="_error_xr6hh_217",G="_ratingSection_xr6hh_237",J="_ratingLabel_xr6hh_253",K="_stars_xr6hh_265",Q="_star_xr6hh_265",W="_filled_xr6hh_313",X="_ratingHint_xr6hh_321",Y="_actions_xr6hh_335",r={createReview:$,container:F,loading:H,header:O,title:k,subtitle:P,content:B,orderInfo:q,orderCard:z,orderDetails:A,reviewForm:M,formTitle:U,error:V,ratingSection:G,ratingLabel:J,stars:K,star:Q,filled:W,ratingHint:X,actions:Y},oe=b(()=>{w();const d=R(),{createReview:u,loading:p}=L,{orders:f,fetchMyOrders:h}=E,[i,v]=n.useState(5),[o,j]=n.useState(""),[m,c]=n.useState(""),{id:g}=C(),t=f.find(s=>s.id===parseInt(g));n.useEffect(()=>{t||h()},[t,h]),n.useEffect(()=>{window.scrollTo(0,0)},[]);const y=async s=>{if(s.preventDefault(),c(""),!o.trim()){c("Пожалуйста, напишите отзыв");return}if(!t){c("Заказ не найден");return}try{const a={orderId:t.id,accountId:t.accountId,ratingValue:i,comment:o.trim()};await u(a),d(`${_.ORDERS}/${t.id}`),window.location.reload()}catch(a){console.error(a),c(a.response?.data?.message||"Ошибка при создании отзыва")}},N=s=>{v(s)},S=()=>Array.from({length:5},(s,a)=>e.jsx("button",{type:"button",className:`${r.star} ${a<i?r.filled:""}`,onClick:()=>N(a+1),children:e.jsx(D,{size:32,fill:a<i?"currentColor":"none"})},a));return t?e.jsx(l.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:r.createReview,children:e.jsxs("div",{className:r.container,children:[e.jsxs(l.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},className:r.header,children:[e.jsx("h1",{className:r.title,children:"Оставить отзыв"}),e.jsx("p",{className:r.subtitle,children:"Поделитесь вашим опытом аренды"})]}),e.jsxs("div",{className:r.content,children:[e.jsx(l.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:r.orderInfo,children:e.jsxs("div",{className:r.orderCard,children:[e.jsx("img",{src:"/api/img/"+t.account?.img,alt:t.account?.title}),e.jsxs("div",{className:r.orderDetails,children:[e.jsx("h3",{children:t.account?.title}),e.jsxs("p",{children:["Заказ #",t.id]}),e.jsxs("p",{children:["Время аренды: ",t.rentPeriod," часов"]})]})]})}),e.jsxs(l.form,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},onSubmit:y,className:r.reviewForm,children:[e.jsx("h2",{className:r.formTitle,children:"Ваш отзыв"}),m&&e.jsx("div",{className:r.error,children:m}),e.jsxs("div",{className:r.ratingSection,children:[e.jsx("label",{className:r.ratingLabel,children:"Оценка"}),e.jsx("div",{className:r.stars,children:S()}),e.jsx("p",{className:r.ratingHint,children:i===5?"Отлично":i===4?"Хорошо":i===3?"Нормально":i===2?"Плохо":"Ужасно"})]}),e.jsx(T,{label:"Комментарий *",type:"textarea",rows:6,value:o,onChange:s=>j(s.target.value),placeholder:"Расскажите о вашем опыте аренды...",required:!0}),e.jsxs("div",{className:r.actions,children:[e.jsx(x,{type:"button",variant:"secondary",onClick:()=>d(`${_.ORDERS}/${t.id}`),children:"Отмена"}),e.jsx(x,{type:"submit",variant:"primary",loading:p,disabled:!o.trim(),children:"Опубликовать отзыв"})]})]})]})]})}):e.jsx("div",{className:r.loading,children:e.jsx(I,{fullScreen:!0})})});export{oe as default};
