import{o as D,r as o,j as n,m as b,L,s as w}from"./index-BMjTxWI5.js";import{B as E}from"./Button-D0cEhXue.js";const S="_verification_thbsm_1",k="_title_thbsm_15",O="_description_thbsm_29",R="_error_thbsm_43",T="_codeInputs_thbsm_63",K="_codeInput_thbsm_63",P="_timer_thbsm_127",V="_resendBtn_thbsm_141",z="_submitBtn_thbsm_177",M="_loadingOverlay_thbsm_187",a={verification:S,title:k,description:O,error:R,codeInputs:T,codeInput:K,timer:P,resendBtn:V,submitBtn:z,loadingOverlay:M},A=D(({userId:g,onSuccess:j})=>{const[i,l]=o.useState(["","","","","",""]),[d,_]=o.useState(!1),[f,m]=o.useState(""),[r,y]=o.useState(60),p=o.useRef([]);o.useEffect(()=>{if(r>0){const t=setTimeout(()=>y(r-1),1e3);return()=>clearTimeout(t)}},[r]);const u=t=>{p.current[t]&&p.current[t].focus()},v=(t,e)=>{if(!/^\d?$/.test(e))return;const s=[...i];s[t]=e,l(s),e&&t<5&&u(t+1),s.every(c=>c!=="")&&t===5&&h(s.join(""))},B=(t,e)=>{e.key==="Backspace"&&!i[t]&&t>0&&u(t-1)},x=t=>{t.preventDefault();const s=t.clipboardData.getData("text").replace(/\D/g,"").slice(0,6).split("");if(s.length===6){const c=[...i];s.forEach((I,C)=>{c[C]=I}),l(c),h(c.join(""))}},h=async(t=i.join(""))=>{if(t.length!==6){m("Введите все 6 цифр кода");return}_(!0),m("");try{await w.verifyLogin(g,t),j()}catch(e){m(e.response?.data?.message||"Неверный код подтверждения"),l(["","","","","",""]),u(0)}finally{_(!1)}},N=()=>{y(60),m(""),l(["","","","","",""]),u(0)};return n.jsxs(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:a.verification,children:[n.jsx("h2",{className:a.title,children:"Подтверждение входа"}),n.jsx("p",{className:a.description,children:"Мы отправили код подтверждения на вашу почту. Введите 6-значный код для завершения входа."}),f&&n.jsx(b.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},className:a.error,children:f}),n.jsx("div",{className:a.codeInputs,children:i.map((t,e)=>n.jsx("input",{ref:s=>p.current[e]=s,type:"text",inputMode:"numeric",maxLength:"1",value:t,onChange:s=>v(e,s.target.value),onKeyDown:s=>B(e,s),onPaste:x,className:a.codeInput,disabled:d},e))}),n.jsx("div",{className:a.timer,children:r>0?n.jsxs("span",{children:["Отправить код повторно через ",r," сек"]}):n.jsx("button",{onClick:N,className:a.resendBtn,disabled:d,children:"Отправить код повторно"})}),n.jsx(E,{variant:"primary",size:"large",loading:d,onClick:()=>h(),className:a.submitBtn,children:"Подтвердить"}),d&&n.jsx("div",{className:a.loadingOverlay,children:n.jsx(L,{})})]})});export{A as V};
